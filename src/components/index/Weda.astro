---
import ShapeFileWeda from "../../assets/svg/shape-file-02-bis.svg";
import CheckSVG from "../../assets/svg/check.svg";
import Hero from "../../assets/photos/visuals/Visuel-08.jpg";

interface Props {
    badge?: string;
    titleLine1?: string;
    titleLine2?: string;
    description?: string;
    bullets?: string[];
    ctaPrimary?: string;
    ctaSecondary?: string;
}

const {
    badge = "PARAMÉTRAGE & FORMATION",
    titleLine1 = "Tirez le meilleur de WEDA",
    titleLine2 = "et gagnez en efficacité.",
    description =
        "Un logiciel métier installé, configuré et sécurisé pour vous.\nFormation incluse et assistance réactive 5j/7 de 6h à 20h.",
    bullets = [
        "Mise en place rapide et formation initiale.",
        "Configuration personnalisée à votre pratique.",
        "Assistance réactive et accompagnement continu.",
    ],
    ctaPrimary = "Je découvre",
    ctaSecondary = "Explorer la base de connaissance",
} = Astro.props as Props;
---

<section id="solutions-weda">
    <div class="p-8 md:p-16 grid lg:grid-cols-5 gap-10 items-center">
        <!-- Left content -->
        <div class="lg:col-span-3">
            <div class="badge badge-outline badge-primary rounded-full border-2 mb-4 font-semibold text-xs sm:text-sm md:text-md">
                {badge}
            </div>

            <h2 class="text-4xl leading-tight">
                {titleLine1}<br/>
                <span class="font-semibold">{titleLine2}</span>
            </h2>

            <p class="mt-6 text-base sm:text-xl whitespace-pre-line">
                {description}
            </p>

            <ul class="mt-6 text-base sm:text-xl space-y-3">
                {bullets.map((item) => (
                        <li class="flex items-start gap-3">
                            <img src={CheckSVG.src} alt="" class="h-5 w-5 mt-0.5"/>
                            <span>{item}</span>
                        </li>
                ))}
            </ul>

            <div class="mt-8 flex flex-wrap gap-4">
                <a class="btn btn-accent hover:bg-accent/80 border-0 shadow-none text-xl text-accent-content rounded-full p-6"
                   href="/en-construction">{ctaPrimary}</a>
                <a class="btn btn-primary text-lg md:text-xl text-accent-content rounded-full p-6 border-0 shadow-none"
                   target="_blank" href="https://base-de-connaissances.toutoleron.com/">{ctaSecondary}</a>
            </div>
        </div>

        <!-- Right illustration -->
        <div id="weda-collage" class="hidden lg:block relative lg:col-span-2">
            <ShapeFileWeda class="w-full h-auto"/>
            <div class="absolute inset-0">
                <img
                        src={Hero.src}
                        alt="Médecin heureux utilisant WEDA"
                        class="weda-hero"
                />
            </div>
        </div>

        <div class="hidden lg:block h-16"/>
    </div>
</section>

<script>
    if (typeof window !== "undefined") {
        const collage = document.getElementById("weda-collage");

        if (collage) {
            const img = collage.querySelector(".weda-hero");

            const observer = new IntersectionObserver(
                (entries) => {
                    entries.forEach((entry) => {
                        if (entry.isIntersecting) {
                            // L’élément entre dans le viewport → animation vers l’état final
                            img?.classList.add("is-visible");
                        } else {
                            // L’élément sort du viewport → retour à l’état initial
                            img?.classList.remove("is-visible");
                        }
                    });
                },
                { threshold: 0.3 }
            );

            observer.observe(collage);
        }
    }
</script>

<style>
    /* État initial : à droite du Shape, un peu plus petit, léger fade-in */
    .weda-hero {
        position: absolute;
        width: 100%;
        height: 100%;
        inset: 0;
        object-fit: cover;
        border-radius: 1rem;
        box-shadow: 0 10px 40px rgba(15, 23, 42, 0.25);

        /* position de départ : à côté du Shape */
        transform: translateX(4rem) translateY(1rem) scale(0.9);
        opacity: 0;

        transition:
                transform 1500ms cubic-bezier(0.22, 1, 0.36, 1),
                opacity 1500ms ease-out;
    }

    /* État final : ta position actuelle "par-dessus" le Shape */
    #weda-collage .weda-hero.is-visible {
        transform: translateX(-2.5rem) translateY(6rem) scale(1);
        opacity: 1;
    }
</style>