---
import ShapeFileSecurity from "../../assets/svg/shape-file-03.svg";
import CheckSVG from "../../assets/svg/check.svg";
import Hero from "../../assets/illustrations/TOUTOLERON_illu_cybersecurite.png";

interface Props {
    badge?: string;
    titleLine1?: string;
    titleLine2?: string;
    description?: string;
    bullets?: string[];
    ctaPrimary?: string;
}

const {
    badge = "CYBERSÉCURITÉ & CONFORMITÉ",
    description =
        "Une solution de cybersécurité complète, pensée pour les professionnels de santé. Surveillance, protection et accompagnement inclus dans une offre clé en main.",
    bullets = [
        "Audit initial et sécurisation de votre environnement numérique",
        "Protection continue contre les intrusions et les logiciels malveillants",
        "Accompagnement personnalisé et support dédié",
    ],
    ctaPrimary = "Je découvre",
} = Astro.props as Props;
---

<section id="security">
    <div class="bg-neutral">

        <div class="h-16"/>

        <div class="p-4 sm:p-16 grid lg:grid-cols-5 gap-16 md:gap-32 items-center">
            <!-- Left illustration -->
            <div id="security-collage"  class="hidden lg:block relative lg:col-span-2">
                <img src={ShapeFileSecurity.src} alt="" class="w-full h-auto"/>
                <div class="absolute inset-20 bottom-10 left-10 -right-10">
                    <img
                            src={Hero.src}
                            alt="Cybersécurité et conformité pour les soignants"
                            class="w-full h-full block security-hero"
                    />
                </div>
            </div>

            <!-- Right content -->
            <div class="lg:col-span-3">
                <div class="badge badge-outline badge-primary rounded-full border-2 mb-4 font-semibold text-xs sm:text-sm md:text-md">
                    {badge}
                </div>

                <h2 class="text-4xl leading-tight">
                    Protégez vos données et votre<br/>
                    activité, <span class="font-semibold">simplement.</span>
                </h2>

                <p class="mt-6 text-base sm:text-xl">
                    {description}
                </p>

                <ul class="mt-6 text-base sm:text-lg space-y-3">
                    {bullets.map((item) => (
                            <li class="flex items-start gap-3">
                                <img src={CheckSVG.src} alt="" class="h-5 w-5 mt-0.5"/>
                                <span>{item}</span>
                            </li>
                    ))}
                </ul>

                <div class="mt-8">
                    <a class="btn btn-accent hover:bg-accent/80 text-accent-content text-xl rounded-full p-6 shadow-none border-0"
                       href="/en-construction">{ctaPrimary}</a>
                </div>
            </div>
        </div>

        <div class="h-16"/>
    </div>
</section>

<script>
    if (typeof window !== "undefined") {
        const collage = document.getElementById("security-collage");

        if (collage) {
            const img = collage.querySelector(".security-hero");

            const observer = new IntersectionObserver(
                (entries) => {
                    entries.forEach((entry) => {
                        if (entry.isIntersecting) {
                            // La section entre dans le viewport → joue l'anim
                            img?.classList.add("is-visible");
                        } else {
                            // La section sort du viewport → reset à l'état initial
                            img?.classList.remove("is-visible");
                        }
                    });
                },
                { threshold: 0.3 }
            );

            observer.observe(collage);
        }
    }
</script>

<style>
    /* État initial : légèrement décalée vers la GAUCHE, un peu réduite, transparente */
    .security-hero {
        transform: translateX(-3rem) translateY(1rem) scale(0.9);
        opacity: 0;

        transition:
                transform 1500ms cubic-bezier(0.22, 1, 0.36, 1),
                opacity 1500ms ease-out;
    }

    /* État final : position normale (celle que tu as déjà actuellement) */
    #security-collage .security-hero.is-visible {
        transform: translateX(0) translateY(0) scale(1);
        opacity: 1;
    }
</style>