---
import PhotoDrDubois from "../assets/photos/visuals/Visuel-09.jpg";
import TestimonialCard from "./TestimonialCard.astro";
import Arrow2 from "../assets/svg/arrow-02.svg";

class CustomerTestimonial {
    constructor(public photo: ImageMetadata, public name: string, public occupation: string, public quote: string) {
        this.photo = photo;
        this.name = name;
        this.occupation = occupation;
        this.quote = quote;
    };
}

const testimonials: CustomerTestimonial[] = [
    new CustomerTestimonial(
        PhotoDrDubois,
        'Dr. Sarah Dubois',
        'Médecin généraliste',
        'Toutoléron a optimisé mon cabinet : matériel en location, maintenance rapide, formations adaptées. Un partenaire indispensable au quotidien !',
    ),
    new CustomerTestimonial(
        PhotoDrDubois,
        'Dr. Sarah Dubois',
        'Médecin généraliste',
        'Toutoléron a optimisé mon cabinet : matériel en location, maintenance rapide, formations adaptées. Un partenaire indispensable au quotidien !',
    ),
    new CustomerTestimonial(
        PhotoDrDubois,
        'Dr. Sarah Dubois',
        'Médecin généraliste',
        'Toutoléron a optimisé mon cabinet : matériel en location, maintenance rapide, formations adaptées. Un partenaire indispensable au quotidien !',
    ),
];
---

<div id="testimonial-carousel" class="carousel w-full h-full overflow-hidden">
    {
        testimonials.map((testimonial, index) => (
                <div id={`temoignage-${index}`} class="carousel-item flex flex-col justify-center items-center w-full h-full">
                    <div class="flex gap-4 lg:p-2">
                        {index > 0 &&
                                <a href={`#temoignage-${index - 1}`}>
                                    <img class="h-16 w-16" src={Arrow2.src} alt="Précédent"/>
                                </a>}
                        {index < testimonials.length - 1 &&
                                <a href={`#temoignage-${index + 1}`}>
                                    <img class="h-16 w-16 rotate-y-180" src={Arrow2.src} alt="Suivant"/>
                                </a>}
                    </div>
                    <TestimonialCard fullName={testimonial.name} occupation={testimonial.occupation}
                                     quote={testimonial.quote} photo={testimonial.photo}/>
                </div>
        ))
    }
</div>
<script>
    if (typeof window !== "undefined") {
        const carousel = document.getElementById("testimonial-carousel");
        if (carousel) {
            const links = carousel.querySelectorAll('a[href^="#temoignage-"]');

            links.forEach((link) => {
                link.addEventListener("click", (event) => {
                    event.preventDefault();

                    const href = link.getAttribute("href");
                    if (!href) return;

                    const targetId = href.substring(1);
                    const target = document.getElementById(targetId);
                    if (!target || !(target instanceof HTMLElement)) return;

                    // Position horizontale de la slide par rapport au conteneur du carousel
                    const targetLeft = target.offsetLeft - carousel.offsetLeft;

                    carousel.scrollTo({
                        left: targetLeft,
                        behavior: "smooth",
                    });
                });
            });
        }
    }
</script>